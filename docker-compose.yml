# # # version: "3.9"
# # services:
# #     nginx:
# #         container_name: my-nginx
# #         depends_on:
# #             - backend
# #         restart: always
# #         build:
# #             context: .
# #             dockerfile: ./nginx/Dockerfile
# #         ports:
# #             - 8080:80
# #         volumes:
# #             - ./nginx/config/default.conf:/etc/nginx/conf.d/default.conf

# #     mysqldb:
# #         image: mysql:5.7
# #         restart: unless-stopped
# #         container_name: my-db
# #         command: --init-file /data/application/init.sql
# #         volumes:
# #             - ./initDB.sql:/data/application/init.sql
# #         environment:
# #             - MYSQL_ROOT_PASSWORD=123456
# #             - MYSQL_DATABASE=stack_overflow
# #         ports:
# #             - 3307:3306

# #     backend:
# #         depends_on:
# #             - mysqldb
# #         restart: unless-stopped
# #         container_name: my-backend
# #         build:
# #             context: ./stackBE
# #         environment:
# #             - DATABASE_PORT=3306
# #             - HOST=mysqldb
# #         ports:
# #             - 8000:8000
# #     # docker compose -p group22 up -d

# services:
#     backend:
#         build: ./stackBE
#         image: 24520115/group22-backend:latest
#         container_name: group22-backend
#         restart: always
#         ports:
#             - "8000:8000"
#         environment:
#             DB_HOST: mysqldb
#             DB_USER: root
#             DB_PASSWORD: 123456
#             DB_NAME: stack_overflow
#         depends_on:
#             - mysqldb

#     frontend:
#         build:
#             context: ./stackFE
#             dockerfile: Dockerfile
#         image: 24520115/group22-frontend:latest
#         container_name: group22-frontend
#         restart: always
#         ports:
#             - "8080:80"
#         depends_on:
#             - backend

#     mysqldb:
#         image: mysql:8
#         container_name: group22-db
#         restart: always
#         environment:
#             MYSQL_ROOT_PASSWORD: 12345
#             MYSQL_DATABASE: stack_overflow
#         ports:
#             - "3307:3306"
#         volumes:
#             - db_data:/var/lib/mysql
#             - ./initDB.sql:/docker-entrypoint-initdb.d/initDB.sql

# volumes:
#     db_data:
version: "3.8"

services:
    # --- Backend Service ---
    my-backend:
        image: 24520115/stack-be:v1
        container_name: stack-backend
        restart: always
        environment:
            # Lấy giá trị từ file .env
            - PORT=${APP_PORT}
            - DB_HOST=${DB_HOST}
            - DB_USER=${DB_USER}
            - DB_PASSWORD=${DB_PASSWORD}
            - DB_NAME=${DB_NAME}
        depends_on:
            - mysqldb
        networks:
            - app-network

    # --- Frontend Service ---
    frontend:
        image: 24520115/stack-fe:v1
        container_name: stack-frontend
        restart: always
        ports:
            # Cổng bên trái lấy từ .env, cổng bên phải (80) là cố định của Nginx trong container
            - "${WEB_PORT}:80"
        depends_on:
            - my-backend
        networks:
            - app-network

    # --- Database Service ---
    mysqldb:
        image: 24520115/stack-db:v1
        container_name: stack-db
        restart: always
        environment:
            # Lấy giá trị từ file .env
            MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
            MYSQL_DATABASE: ${MYSQL_DATABASE}
        volumes:
            - db_data:/var/lib/mysql
        networks:
            - app-network

networks:
    app-network:
        driver: bridge

volumes:
    db_data:
